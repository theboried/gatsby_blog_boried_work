{"version":3,"sources":["../../src/utils/babel-config.js"],"names":["apiRunnerNode","require","store","buildConfig","abstractConfig","stage","babelrc","options","presets","plugins","forEach","p","push","resolve","name","hasOwnProperty","cacheDirectory","unshift","exports","createBabelConfig","program","babelrcState","getState","stages","babelConfig"],"mappings":";;AAEA,MAAMA,gBAAgBC,QAAS,mBAAT,CAAtB;;iBACkBA,QAAS,UAAT,C;MAAVC,K,YAAAA,K;;AAER,MAAMC,cAAc,CAACC,cAAD,EAAiBC,KAAjB,KAA2B;AAC7C,MAAIC,4BACCF,eAAeG,OADhB;AAEFC,aAAS,EAFP;AAGFC,aAAS;AAHP,IAAJ;AAMAL,iBAAeI,OAAf,CAAuBE,OAAvB,CAA+BC,KAC7BL,QAAQE,OAAR,CAAgBI,IAAhB,CAAqB,CAACX,QAAQY,OAAR,CAAgBF,EAAEG,IAAlB,CAAD,EAA0BH,EAAEJ,OAA5B,CAArB,CADF;AAGAH,iBAAeK,OAAf,CAAuBC,OAAvB,CAA+BC,KAC7BL,QAAQG,OAAR,CAAgBG,IAAhB,CAAqB,CAACX,QAAQY,OAAR,CAAgBF,EAAEG,IAAlB,CAAD,EAA0BH,EAAEJ,OAA5B,CAArB,CADF;;AAIA,MAAI,CAACD,QAAQS,cAAR,CAAwB,gBAAxB,CAAL,EAA+C;AAC7CT,YAAQU,cAAR,GAAyB,IAAzB;AACD;;AAED,MAAIX,UAAW,SAAf,EAAyB;AACvB;AACAC,YAAQG,OAAR,CAAgBQ,OAAhB,CAAwBhB,QAAQY,OAAR,CAAiB,wBAAjB,CAAxB;AACD,GArB4C,CAuB7C;;;AACA,MAAIR,UAAW,YAAX,IAA0BA,UAAW,cAAzC,EAAwD;AACtDC,YAAQG,OAAR,CAAgBQ,OAAhB,CAAwBhB,QAAQY,OAAR,CAAiB,kCAAjB,CAAxB;AACD;;AAEDP,UAAQG,OAAR,CAAgBQ,OAAhB,CACEhB,QAAQY,OAAR,CAAiB,qCAAjB,CADF;AAIA,SAAOP,OAAP;AACD,CAjCD;;AAmCAY,QAAQf,WAAR,GAAsBA,WAAtB;AAEA;;;;;AAIAe,QAAQC,iBAAR;AAAA;AAAA;AAAA,uCAA4B,WAA2BC,OAA3B,EAAoCf,KAApC,EAA2C;AACrE,UAAML,cAAe,qBAAf,EAAqC;AAAEK;AAAF,KAArC,CAAN;AACA,UAAMgB,eAAenB,MAAMoB,QAAN,GAAiBhB,OAAtC;AACA,QAAIA,UAAUH,YAAYkB,aAAaE,MAAb,CAAoBlB,KAApB,CAAZ,EAAwCA,KAAxC,CAAd;AAEA,WAAOC,OAAP;AACD,GAND;;AAAA,kBAA2CkB,WAA3C;AAAA;AAAA;AAAA","file":"babel-config.js","sourcesContent":["/* @flow */\n\nconst apiRunnerNode = require(`./api-runner-node`)\nconst { store } = require(`../redux`)\n\nconst buildConfig = (abstractConfig, stage) => {\n  let babelrc = {\n    ...abstractConfig.options,\n    presets: [],\n    plugins: [],\n  }\n\n  abstractConfig.presets.forEach(p =>\n    babelrc.presets.push([require.resolve(p.name), p.options])\n  )\n  abstractConfig.plugins.forEach(p =>\n    babelrc.plugins.push([require.resolve(p.name), p.options])\n  )\n\n  if (!babelrc.hasOwnProperty(`cacheDirectory`)) {\n    babelrc.cacheDirectory = true\n  }\n\n  if (stage === `develop`) {\n    // TODO: maybe this should be left to the user?\n    babelrc.plugins.unshift(require.resolve(`react-hot-loader/babel`))\n  }\n\n  // Make dynamic imports work during SSR.\n  if (stage === `build-html` || stage === `develop-html`) {\n    babelrc.plugins.unshift(require.resolve(`babel-plugin-dynamic-import-node`))\n  }\n\n  babelrc.plugins.unshift(\n    require.resolve(`babel-plugin-remove-graphql-queries`)\n  )\n\n  return babelrc\n}\n\nexports.buildConfig = buildConfig\n\n/**\n * Returns a normalized Babel config to use with babel-loader. All of\n * the paths will be absolute so that Babel behaves as expected.\n */\nexports.createBabelConfig = async function babelConfig(program, stage) {\n  await apiRunnerNode(`onCreateBabelConfig`, { stage })\n  const babelrcState = store.getState().babelrc\n  let babelrc = buildConfig(babelrcState.stages[stage], stage)\n\n  return babelrc\n}\n"]}