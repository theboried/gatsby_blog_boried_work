{"version":3,"sources":["../../src/bootstrap/get-config-file.js"],"names":["levenshtein","require","fs","testRequireError","default","report","chalk","path","isNearMatch","fileName","configName","distance","get","module","exports","rootDir","configPath","join","configModule","err","nearMatch","readdir","then","files","find","file","split","pop","error","process","exit","console","log","bold","existsSync","getConfigFile"],"mappings":";;AACA,MAAMA,cAAcC,QAAS,kBAAT,CAApB;;AACA,MAAMC,KAAKD,QAAS,UAAT,CAAX;;AACA,MAAME,mBAAmBF,QAAS,6BAAT,EAAuCG,OAAhE;;AACA,MAAMC,SAASJ,QAAS,yBAAT,CAAf;;AACA,MAAMK,QAAQL,QAAS,OAAT,CAAd;;AACA,MAAMM,OAAON,QAAS,MAAT,CAAb;;AAEA,SAASO,WAAT,CACEC,QADF,EAEEC,UAFF,EAGEC,QAHF,EAIW;AACT,SAAOX,YAAYY,GAAZ,CAAgBH,QAAhB,EAA0BC,UAA1B,KAAyCC,QAAhD;AACD;;AAEDE,OAAOC,OAAP;AAAA;AAAA;AAAA,yCAAiB,WACfC,OADe,EAEfL,UAFe,EAGfC,WAAmB,CAHJ,EAIf;AACA,UAAMK,aAAaT,KAAKU,IAAL,CAAUF,OAAV,EAAmBL,UAAnB,CAAnB;AACA,QAAIQ,YAAJ;;AACA,QAAI;AACFA,qBAAejB,QAAQe,UAAR,CAAf;AACD,KAFD,CAEE,OAAOG,GAAP,EAAY;AACZ,YAAMC,kBAAkBlB,GAAGmB,OAAH,CAAWN,OAAX,EAAoBO,IAApB,CAAyBC,SAC/CA,MAAMC,IAAN,CAAWC,QAAQ;AACjB,cAAMhB,WAAWgB,KAAKC,KAAL,CAAWX,OAAX,EAAoBY,GAApB,EAAjB;AACA,eAAOnB,YAAYC,QAAZ,EAAsBC,UAAtB,EAAkCC,QAAlC,CAAP;AACD,OAHD,CADsB,CAAxB;;AAMA,UAAI,CAACR,iBAAiBa,UAAjB,EAA6BG,GAA7B,CAAL,EAAwC;AACtCd,eAAOuB,KAAP,CACG,4DAA2DlB,UAAW,uCADzE,EAEES,GAFF;AAIAU,gBAAQC,IAAR,CAAa,CAAb;AACD,OAND,MAMO,IAAIV,SAAJ,EAAe;AACpBW,gBAAQC,GAAR,CAAa,EAAb;AACA3B,eAAOuB,KAAP,CACG,wEAAuEtB,MAAM2B,IAAN,CACtEb,SADsE,CAEtE,SAAQd,MAAM2B,IAAN,CAAWvB,UAAX,CAAuB,GAHnC;AAKAqB,gBAAQC,GAAR,CAAa,EAAb;AACAH,gBAAQC,IAAR,CAAa,CAAb;AACD,OATM,MASA,IAAI5B,GAAGgC,UAAH,CAAc3B,KAAKU,IAAL,CAAUF,OAAV,EAAoB,KAApB,EAA0BL,UAA1B,CAAd,CAAJ,EAA0D;AAC/DqB,gBAAQC,GAAR,CAAa,EAAb;AACA3B,eAAOuB,KAAP,CACG,QAAOlB,UAAW,kJADrB;AAGAqB,gBAAQC,GAAR,CAAa,EAAb;AACAH,gBAAQC,IAAR,CAAa,CAAb;AACD;AACF;;AAED,WAAOZ,YAAP;AACD,GA1CD;;AAAA,kBAAgCiB,aAAhC;AAAA;AAAA;AAAA","file":"get-config-file.js","sourcesContent":["/* @flow */\nconst levenshtein = require(`fast-levenshtein`)\nconst fs = require(`fs-extra`)\nconst testRequireError = require(`../utils/test-require-error`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst chalk = require(`chalk`)\nconst path = require(`path`)\n\nfunction isNearMatch(\n  fileName: string,\n  configName: string,\n  distance: number\n): boolean {\n  return levenshtein.get(fileName, configName) <= distance\n}\n\nmodule.exports = async function getConfigFile(\n  rootDir: string,\n  configName: string,\n  distance: number = 3\n) {\n  const configPath = path.join(rootDir, configName)\n  let configModule\n  try {\n    configModule = require(configPath)\n  } catch (err) {\n    const nearMatch = await fs.readdir(rootDir).then(files =>\n      files.find(file => {\n        const fileName = file.split(rootDir).pop()\n        return isNearMatch(fileName, configName, distance)\n      })\n    )\n    if (!testRequireError(configPath, err)) {\n      report.error(\n        `We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`,\n        err\n      )\n      process.exit(1)\n    } else if (nearMatch) {\n      console.log(``)\n      report.error(\n        `It looks like you were trying to add the config file? Please rename \"${chalk.bold(\n          nearMatch\n        )}\" to \"${chalk.bold(configName)}\"`\n      )\n      console.log(``)\n      process.exit(1)\n    } else if (fs.existsSync(path.join(rootDir, `src`, configName))) {\n      console.log(``)\n      report.error(\n        `Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`\n      )\n      console.log(``)\n      process.exit(1)\n    }\n  }\n\n  return configModule\n}\n"]}