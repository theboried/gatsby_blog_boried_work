{"version":3,"sources":["../../../src/schema/types/type-date.js"],"names":["moment","require","GraphQLString","GraphQLBoolean","GraphQLScalarType","Kind","_","oneLine","ISO_8601_FORMAT","shouldInfer","value","momentDate","utc","isValid","GraphQLDate","name","description","serialize","String","parseValue","parseLiteral","ast","kind","STRING","undefined","type","Object","freeze","args","formatString","fromNow","difference","locale","resolve","source","context","fieldName","date","JSON","parse","stringify","isPlainObject","format","diff","getType"],"mappings":"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","file":"type-date.js","sourcesContent":["const moment = require(`moment`)\nconst {\n  GraphQLString,\n  GraphQLBoolean,\n  GraphQLScalarType,\n  Kind,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\n\nconst ISO_8601_FORMAT = [\n  `YYYY`,\n  `YYYY-MM`,\n  `YYYY-MM-DD`,\n  `YYYYMMDD`,\n  `YYYY-MM-DDTHHZ`,\n  `YYYY-MM-DDTHH:mmZ`,\n  `YYYY-MM-DDTHHmmZ`,\n  `YYYY-MM-DDTHH:mm:ssZ`,\n  `YYYY-MM-DDTHHmmssZ`,\n  `YYYY-MM-DDTHH:mm:ss.SSSZ`,\n  `YYYY-MM-DDTHHmmss.SSSZ`,\n  `YYYY-[W]WW`,\n  `YYYY[W]WW`,\n  `YYYY-[W]WW-E`,\n  `YYYY[W]WWE`,\n  `YYYY-DDDD`,\n  `YYYYDDDD`,\n]\n\n// Check if this is a date.\n// All the allowed ISO 8601 date-time formats used.\nexport function shouldInfer(value) {\n  const momentDate = moment.utc(value, ISO_8601_FORMAT, true)\n  return momentDate.isValid() && typeof value !== `number`\n}\n\nexport const GraphQLDate = new GraphQLScalarType({\n  name: `Date`,\n  description: oneLine`\n    A date string, such as 2007-12-03, compliant with the ISO 8601 standard \n    for representation of dates and times using the Gregorian calendar.`,\n  serialize: String,\n  parseValue: String,\n  parseLiteral(ast) {\n    return ast.kind === Kind.STRING ? ast.value : undefined\n  },\n})\n\nconst type = Object.freeze({\n  type: GraphQLDate,\n  args: {\n    formatString: {\n      type: GraphQLString,\n      description: oneLine`\n        Format the date using Moment.js' date tokens e.g.\n        \"date(formatString: \"YYYY MMMM DD)\"\n        See https://momentjs.com/docs/#/displaying/format/\n        for documentation for different tokens`,\n    },\n    fromNow: {\n      type: GraphQLBoolean,\n      description: oneLine`\n        Returns a string generated with Moment.js' fromNow function`,\n    },\n    difference: {\n      type: GraphQLString,\n      description: oneLine`\n        Returns the difference between this date and the current time.\n        Defaults to miliseconds but you can also pass in as the\n        measurement years, months, weeks, days, hours, minutes,\n        and seconds.`,\n    },\n    locale: {\n      type: GraphQLString,\n      description: oneLine`\n        Configures the locale Moment.js will use to format the date.`,\n    },\n  },\n  resolve(source, args, context, { fieldName }) {\n    let date\n    if (source[fieldName]) {\n      date = JSON.parse(JSON.stringify(source[fieldName]))\n    } else {\n      return null\n    }\n\n    if (_.isPlainObject(args)) {\n      const { fromNow, difference, formatString, locale = `en` } = args\n      if (formatString) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .format(formatString)\n      } else if (fromNow) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .fromNow()\n      } else if (difference) {\n        return moment().diff(\n          moment.utc(date, ISO_8601_FORMAT, true).locale(locale),\n          difference\n        )\n      }\n    }\n\n    return date\n  },\n})\n\nexport function getType() {\n  return type\n}\n"]}