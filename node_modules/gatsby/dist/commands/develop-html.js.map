{"version":3,"sources":["../../src/commands/develop-html.js"],"names":["fs","require","webpack","createErrorFromString","debug","webpackConfig","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","console","log","unlinkSync"],"mappings":";;AACA,MAAMA,KAAKC,QAAS,IAAT,CAAX;;AACA,MAAMC,UAAUD,QAAS,SAAT,CAAhB;;iBACkCA,QAAS,gCAAT,C;MAA1BE,qB,YAAAA,qB;;AACR,MAAMC,QAAQH,QAAS,OAAT,EAAkB,aAAlB,CAAd;;AACA,MAAMI,gBAAgBJ,QAAS,yBAAT,CAAtB;;AAEAK,OAAOC,OAAP;AAAA;AAAA;AAAA,+BAAiB,WAAOC,OAAP,EAAwB;AAAA,UAC/BC,SAD+B,GACjBD,OADiB,CAC/BC,SAD+B;AAGvCL,UAAO,wBAAP,EAHuC,CAKvC;;AACA,UAAMM,uBAAuBL,cAC3BG,OAD2B,EAE3BC,SAF2B,EAG1B,cAH0B,EAI3B,IAJ2B,EAK3B,CAAE,GAAF,CAL2B,CAA7B;AAQA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCX,cAAQQ,cAAR,EAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,YAAID,CAAJ,EAAO;AACL,iBAAOF,OAAOE,CAAP,CAAP;AACD;;AACD,cAAME,aAAc,GAAER,SAAU,wBAAhC;;AACA,YAAIO,MAAME,SAAN,EAAJ,EAAuB;AACrB,cAAIC,gBAAgBH,MAAMI,MAAN,GAAeC,MAAnC;AACAC,kBAAQC,GAAR,CAAa,MAAb,EAAoBJ,cAAc,CAAd,CAApB;AACA,iBAAON,OACLV,sBAAsBgB,cAAc,CAAd,CAAtB,EAAyC,GAAEF,UAAW,MAAtD,CADK,CAAP;AAGD,SAXuC,CAaxC;;;AACA,YAAI;AACFjB,aAAGwB,UAAH,CAAcP,UAAd;AACD,SAFD,CAEE,OAAOF,CAAP,EAAU,CACV;AACD;;AAED,eAAOH,QAAQ,IAAR,EAAcI,KAAd,CAAP;AACD,OArBD;AAsBD,KAvBM,CAAP;AAwBD,GAtCD;;AAAA;AAAA;AAAA;AAAA","file":"develop-html.js","sourcesContent":["/* @flow */\nconst fs = require(`fs`)\nconst webpack = require(`webpack`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst debug = require(`debug`)(`gatsby:html`)\nconst webpackConfig = require(`../utils/webpack.config`)\n\nmodule.exports = async (program: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `develop-html`,\n    null,\n    [`/`]\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors\n        console.log(`here`, webpackErrors[0])\n        return reject(\n          createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n        )\n      }\n\n      // Remove the temp JS bundle file built for the static-site-generator-plugin\n      try {\n        fs.unlinkSync(outputFile)\n      } catch (e) {\n        // This function will fail on Windows with no further consequences.\n      }\n\n      return resolve(null, stats)\n    })\n  })\n}\n"]}